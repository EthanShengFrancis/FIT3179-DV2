{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
  "text": "Tourist Arrivals to Malaysia by Country of Nationality (2019 to 2024)",
  "font": "Times New Roman",
  "fontSize": 25,
  "anchor": "middle",
  "align": "center"
  },

  "vconcat": [
    {
      "title": "Choropleth map from 2019 to 2024 - Select a year with the slider",
      "width": 800,
      "height": 420,
      "projection": {"type": "equalEarth"},
      "layer": [
        {
          "data": {"sphere": true},
          "mark": {"type": "geoshape", "fill": "#6fb4ff"}
        },
        {
          "data": {"graticule": true},
          "mark": {"type": "geoshape", "stroke": "#ccc", "strokeWidth": 0.5}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
            "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
          },
          "mark": {"type": "geoshape", "fill": null, "stroke": "black", "strokeWidth": 0.5}
        },
        {
          "name": "choropleth",
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
            "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
          },
          "transform": [
            {
              "lookup": "properties.NAME",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/EthanShengFrancis/Homework-Week-10/main/data/FIT3179%20DV2%20Map.csv"
                },
                "key": "Country",
                "fields": ["2019", "2022", "2023", "2024"]
              }
            },
            {
              "calculate": "toNumber(datum[toString(Year_selection)])",
              "as": "Tourists"
            },
            {
              "joinaggregate": [{"op": "sum", "field": "Tourists", "as": "TotalArrivals"}]
            },
            {
              "calculate": "datum['Tourists'] / datum['TotalArrivals'] * 100",
              "as": "ArrivalsPercentage"
            },
            {
              "calculate": "toString(Year_selection)",
              "as": "SelectedYear_string"
            }
          ],
          "mark": {"type": "geoshape"},
          "encoding": {
            "color": {
              "condition": {
                "test": "isValid(datum['Tourists']) && datum['Tourists'] > 0",
                "field": "ArrivalsPercentage",
                "type": "quantitative",
                "scale": {"scheme": "greens"},
                "legend": {"title": "Arrivals (% of total)"}
              },
              "value": "lightgray"
            },
            "tooltip": [
              {"field": "properties.NAME", "type": "nominal", "title": "Country"},
              {"field": "Tourists", "type": "quantitative", "title": "Arrivals (selected year)", "format": ","},
              {"field": "ArrivalsPercentage", "type": "quantitative", "title": "Share (%)", "format": ".2f"},
              {"field": "SelectedYear_string", "type": "nominal", "title": "Year"}
            ]
          }
        },
        {
          "data": {
            "values": [
              {"Country": "Singapore", "Longitude": 81.819836, "Latitude": -9.352083, "Label": "SINGAPORE has the \\n highest arrivals in \\n 2019, 2023 and 2024."},
              {"Country": "Antarctica", "Longitude": 0.071389, "Latitude": -55.250973, "Label": "Grey countries have below 15000 arrivals \\n throughout 2019 to 2024"},
              {"Country": "China", "Longitude": 150.195397, "Latitude": 21.86166, "Label": "CHINA had the biggest\\n growth rate of 593.4 \\n during 2022 to 2023."}
            ]
          },
          "mark": {"type": "text", "fontSize": 10, "fontWeight": "bold", "dy": -5, "color": "black", "lineBreak": "\\n"},
          "encoding": {
            "longitude": {"field": "Longitude", "type": "quantitative"},
            "latitude": {"field": "Latitude", "type": "quantitative"},
            "text": {"field": "Label"}
          }
        },
        {
          "data": {
            "values": [
              {"Longitude": 2.21, "Latitude": 46.23},
              {"Longitude": 138.25, "Latitude": 36.2},
              {"Longitude": 133.78, "Latitude": -25.27}
            ]
          },
          "mark": {"type": "circle", "size": 40, "color": "red"}
        }
      ]
    }
  ]
}
