{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
  "text": "Tourist Arrivals to Malaysia by Country of Nationality (2019 to 2024)",
  "font": "Arial",
  "fontSize": 40,
  "anchor": "middle",
  "align": "center"
  },

  "vconcat": [
    {
      "width": 1100,
      "height": 820,
      "projection": {"type": "equalEarth"},
      "layer": [
        {
          "data": {"sphere": true},
          "mark": {"type": "geoshape", "fill": "#6fb4ff"}
        },
        {
          "data": {"graticule": true},
          "mark": {"type": "geoshape", "stroke": "#ccc", "strokeWidth": 0.5}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
            "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
          },
          "mark": {"type": "geoshape", "fill": null, "stroke": "black", "strokeWidth": 0.5}
        },
        {
          "name": "choropleth",
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
            "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
          },
          "transform": [
            {
              "lookup": "properties.NAME",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/EthanShengFrancis/FIT3179-DV2/main/data/FIT3179%20DV2%20Map.csv"
                },
                "key": "Country",
                "fields": ["2019", "2022", "2023", "2024"]
              }
            },
            {
              "calculate": "toNumber(datum[toString(Year_selection)])",
              "as": "Tourists"
            },
            {
              "joinaggregate": [{"op": "sum", "field": "Tourists", "as": "TotalArrivals"}]
            },
            {
              "calculate": "datum['Tourists'] / datum['TotalArrivals'] * 100",
              "as": "ArrivalsPercentage"
            },
            {
              "calculate": "toString(Year_selection)",
              "as": "SelectedYear_string"
            }
          ],
          "mark": {"type": "geoshape"},
          "encoding": {
            "color": {
              "condition": {
                "test": "isValid(datum['Tourists']) && datum['Tourists'] > 0",
                "field": "ArrivalsPercentage",
                "type": "quantitative",
                "scale": {"scheme": "greens"},
                "legend": {"title": "Arrivals (% of total)"}
              },
              "value": "lightgray"
            },
            "tooltip": [
              {"field": "properties.NAME", "type": "nominal", "title": "Country"},
              {"field": "Tourists", "type": "quantitative", "title": "Arrivals (selected year)", "format": ","},
              {"field": "ArrivalsPercentage", "type": "quantitative", "title": "Share (%)", "format": ".2f"},
              {"field": "SelectedYear_string", "type": "nominal", "title": "Year"}
            ]
          }
        },
        {
          "data": {
            "values": [
              {"Country": "Singapore", "Longitude": 81.819836, "Latitude": -9.352083, "Label": "SINGAPORE has the \\n highest arrivals in \\n 2019, 2023 and 2024."},
              {"Country": "Antarctica", "Longitude": 0.071389, "Latitude": -55.250973, "Label": "Grey countries have below 15000 arrivals \\n throughout 2019 to 2024"},
              {"Country": "China", "Longitude": 150.195397, "Latitude": 21.86166, "Label": "CHINA had the biggest\\n growth rate of 593.4 \\n during 2022 to 2023."}
            ]
          },
          "mark": {"type": "text", "fontSize": 10, "fontWeight": "bold", "dy": -5, "color": "black", "lineBreak": "\\n"},
          "encoding": {
            "longitude": {"field": "Longitude", "type": "quantitative"},
            "latitude": {"field": "Latitude", "type": "quantitative"},
            "text": {"field": "Label"}
          }
        }
      ]
    }
  ],
  "params": [
    {
      "name": "Year_selection",
      "value": 2024,
      "bind": {
        "input": "range",
        "min": 2019,
        "max": 2024,
        "step": 1,
        "name": "Map Year for Choropleth Map: "
      }
    }
  ]
}
